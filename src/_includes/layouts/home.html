{%- extends "layouts/base.html" -%}

{%- block content -%}
  {%- include "partials/hero-section.html" -%}
  {%- include "partials/product-section.html" -%}
  <div class="grid">
    {%- include "partials/about-section.html" -%}
    {%- include "partials/contact-section.html" -%}
  </div>
  {{ content | safe }}
  
  {# TODO: defer scripts? #}
  <script>
    const header = document.querySelector(".site-head");
    const intercept = document.querySelector(".skip-to-main");

    const observer = new IntersectionObserver(([entry]) => {
      header.toggleAttribute("data-sticky", !entry.isIntersecting);
    });

    observer.observe(intercept);
  </script>

  {# TODO: defer scripts? #}
  <script>
    function toggleDisclosure() {
      if (this.getAttribute("aria-expanded") == "false") {
        this.innerText = " Read Less";
        this.setAttribute("aria-expanded", "true");
        this.previousElementSibling.setAttribute('data-state', 'visible');
      } 
      else {
        this.innerText = " Read More";
        this.setAttribute("aria-expanded", "false");
        this.previousElementSibling.setAttribute('data-state', 'hidden');
      }
    }
    const disclosureWidget = document.querySelectorAll('.disclosure-widget');
    const readMoreButton = document.querySelectorAll('.read-more');

    disclosureWidget.forEach( el => el.setAttribute('data-state', 'hidden'));
    readMoreButton.forEach( el => el.addEventListener("click", toggleDisclosure));
  </script>
  <script>
    const parentElement = document.querySelector(".product-materials-list");
    const childrenElements = parentElement.children;
    for (let child of childrenElements) {
      const childHeight = child.clientHeight;
      const targetElement = child.querySelector("img");
      if (targetElement) {
        targetElement.style.setProperty("--max-height", childHeight);
      }
    }
  </script>
{%- endblock -%}